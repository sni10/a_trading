"""Интерфейс (протокол) для внешнего хранилища снапшотов state.

На этом этапе снапшот рассматривается как произвольный ``dict`` с
JSON‑совместимыми значениями. Ключ (``key``) кодирует процесс/пару,
например ``"local:BTC/USDT"``.

Цель – позволить приложению прозрачно заменить файловое хранилище на
Redis или другой backend без изменения бизнес‑логики, которая оперирует
только диктом снапшота.
"""

from __future__ import annotations

from typing import Any, Dict, Protocol, runtime_checkable


@runtime_checkable
class IStateSnapshotStore(Protocol):
    """Абстракция над backend‑хранилищем снапшотов state.

    Минимальный контракт: сохранить и загрузить снимок по строковому
    ключу. Реализация сама решает, как маппить ключ на файл/ключ Redis
    и т.п.
    """

    def save_snapshot(self, key: str, snapshot: Dict[str, Any]) -> None:
        """Сохранить снапшот под указанным ключом.

        Реализации должны быть идемпотентны: повторный вызов с тем же
        ключом и данными не должен ломать состояние.
        """

    def load_snapshot(self, key: str) -> Dict[str, Any] | None:
        """Загрузить снапшот по ключу или вернуть ``None``, если его нет."""


__all__ = ["IStateSnapshotStore"]
